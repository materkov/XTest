XTest
=====

## Ход разработки

### 14.09.2016

Создал приложение на симфони. Пока что обойдемся без авторизации. Создадим первый метод, который
показывает список файлов. Он должен быть тестируемым. Нужно будет мокать файловую систему.
Нужно чтобы контроллер был абстрагирован от операций с ФС.

Поэтому создадим сервис FileManager. Добавим в него метод listDir (вместе с юнит-тестом).

ОК, теперь создадим метод, возвращающий список файлов и использующий этот сервис
(вместе с функциональным тестом). Неплохое начало.

Теперь про авторизацию. Добавим сущность User (из FOSUserBundle).

ОК. Теперь есть HTTP Basic Auth, все адреса защищены. На всякий случай 
запишу здесь: user - pass 

Разберемся с метаданными файла. Добавим в FileManager getMeta.
Будем использовать встроенную функцию finfo_file. Одновременно тестик. Все ОК.

Во время написания теста, обнаруживается, что предыдущие поломались,
т.к. авторизация доабвилась. Нужно разобраться с фикстурами чтобы создать
фейкового пользователя перед запуском тестов.

### 15.09.2016
Разобрался с фикстурами (фейковыми данными для тестов).

Если файл отсутствует, возвращается 404.

Добавил возврат содержимого файла, добавил корректные заголовки Content-Type (тесты
тоже обновил).

Добавил метод создания файла (вместе с добавлением новых методов в сервис и вместе с
тестами).


### 16.09.2016
Ронял что отдельный метод POST /files получается, его можно заменить
на PUT /file/{name}. Почитал стандарт - он позволяет делать такое 
(в случае если файла нет создавать и отвечать 201, в случае если есть - 
обновлять и отвечать 200). Решил метод POST убрать, однако тут возникла загвоздка...
Файлы в PHP принимаются только если тип запроса - POST.

Решил это тем, что создал второй контроллер и запилиил метод там.
Изменился менеджер, теперь он читает из php://input и сохраняет сразу же
в файл. Тестики прилагаются. Ан нет, этот php://input нетестируемый получился.
Использую встроенный метод getContent(). Теперь порядок.

ОК. Теперь тесты мне нравятся совсем. Полностью их переосмыслилю. Разделил на две папочки
Unit и Functional, из функциональных выкинул моки (моки ведь только для юнит тестов, чего это я).

Вот, теперь базовый функционал полностью готов. Радуемся и пляшем.


## Endpoints

### PUT /files/{filename}
Обновить содержимое файла из данных в запросе (тело запроса является непосредственно файлом).
Команда курла примерно такая
`curl -X PUT http://localhost:8000/files/1.txt -u user:pass --data @"file.txt"`

Если файла не существует, он создается и возвращается 201. Если уже есть, обновляется
и возвращается 200.

В случае неверного имени файла изи пустого тела, возвращается 400 с ошибкой.


### GET /files/{filename}
Получить содержимое файла

Если файл отсутствует, возвращает 404 и ошибку.


### GET /files/{filename}/meta
Получить метаданные файла

Если файл отсутствует, возвращает 404 и ошибку.


### GET /files
Получить список файлов.


